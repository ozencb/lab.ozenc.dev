#!/bin/sh

#
# Pre-commit hook for lab.ozenc.dev
#
# This hook validates the manifest.json file before allowing commits
# to ensure the project registry remains consistent and valid.
#

echo "ğŸ” Running pre-commit checks..."

# Check if manifest.json exists
if [ ! -f "manifest.json" ]; then
  echo "âŒ Error: manifest.json not found in repository root"
  echo "ğŸ’¡ Please ensure manifest.json exists before committing"
  exit 1
fi

# Run manifest validation
echo "ğŸ“‹ Validating manifest.json..."

if npm run validate --silent; then
  echo "âœ… Manifest validation passed"
else
  echo ""
  echo "âŒ Manifest validation failed!"
  echo "ğŸ’¡ Please fix the manifest issues above before committing"
  echo "ğŸ’¡ Run 'npm run validate' to see detailed error information"
  exit 1
fi

# Check if shared package builds successfully (if modified)
if git diff --cached --name-only | grep -q "^shared/"; then
  echo "ğŸ”§ Shared package modified, checking build..."
  
  if cd shared && npm run build --silent && cd ..; then
    echo "âœ… Shared package builds successfully"
  else
    echo "âŒ Shared package build failed!"
    echo "ğŸ’¡ Please fix build errors before committing"
    exit 1
  fi
fi

echo "ğŸ‰ All pre-commit checks passed!"
exit 0 
